bootstrap: docker
from: ubuntu:24.04

%post
    set -e
    export DEBIAN_FRONTEND=noninteractive

    echo "deb http://archive.ubuntu.com/ubuntu noble universe" >> /etc/apt/sources.list
    apt-get update

    apt-get install -y python3-dev python3-pip python3-full swig git libgl1 libglib2.0-0

    python3 -m venv /venv
    . /venv/bin/activate

    pip install "hockey @ git+https://git@github.com/martius-lab/hockey-env.git"
    pip install "comprl @ git+https://github.com/martius-lab/teamproject-competition-server.git#egg=comprl&subdirectory=comprl"
    
    pip install torch torchvision --index-url https://download.pytorch.org/whl/cu118
    pip install pufferlib ray
    pip install "opencv-python<4.9"
    pip install gymnasium[mujoco] matplotlib omegaconf wandb[media]

    # cleanup
    apt-get clean
    pip cache purge


%runscript
    . /venv/bin/activate
    "$@"
